#### Exploratory plots

```{r, cache=FALSE}
# npp = 41 # n participants
data <- alldata

npp = length(unique(data$id)) # n participants 

blocks <- data[data$trial_number == max(data$trial_number),]

# avg score per block across pp's
cdata.bl <- aggregate(blocks["block_score"], by=blocks[c("block_id", "age_group")], FUN=mean)
names(cdata.bl)[names(cdata.bl)=="block_score"] <- "m"
cdata.bl <- ddply(cdata.bl, "age_group", transform, g.m = mean(m)) # plyr method for group means
cdata.bl$high <- cdata.bl$m - cdata.bl$g.m # how far off the group mean someone in a block is

blocks <- blocks[order(blocks$id, blocks$block_id),]
blocks$block_size_id <- 0
blocks$block_size_id[blocks$block_size == 4] <- rep(1:8,npp) ## following experiment order
blocks$block_size_id[blocks$block_size == 8] <- rep(1:8,npp) ## following experiment order

blocks <- blocks[order(blocks$id, blocks$real_block_id),]
blocks$block_size_real_id <- 0
blocks$block_size_real_id[blocks$block_size == 4] <- rep(1:8,npp) ## following experiment order
blocks$block_size_real_id[blocks$block_size == 8] <- rep(1:8,npp) ## following experiment order
```

```{r, eval=T}
source("extra.R")

load("../processed/data.ev-final.RData", verbose = F)

W_OPT = .6

regret <- function(choices) { 
    return(cumsum(W_OPT - as.double(as.character(choices))))
}


blocks$regret = 0
for(i in 1:length(unique(data.ev$id))) {
 for(j in 1:length(unique(data.ev$block_id))) {
    problem <- data.ev[data.ev$block_id == j & data.ev$id == unique(data.ev$id)[i],]
    banditcnt <- problem$block_size[1]
    evs <- sort(unique(data.ev$ev))  
    if(problem$block_size[1] == 4) {evs <- evs[5:8]}
    ev_positions = match(problem$ev, evs)
    blocks$regret[blocks$block_id == j & blocks$id == unique(blocks$id)[i]] = round(tail(regret(problem$ev), n = 1), digits = 1)
 }
}
# head(blocks, n = 40)
```

```{r}
tgc <- summarySE(blocks, measurevar="block_score", groupvars=c("block_size_id","age_group", "block_size"))
tgc$block_size <- as.factor(tgc$block_size )
blocks$block_size_id <- as.factor(as.character(blocks$block_size_id))
tgc$age_group <- factor(tgc$age_group, levels = rev(levels(tgc$age_group)))
# pdf("plot-%d.pdf", width=inch_width, height=inch_height, pointsize = pointsize)
ggplot(blocks, aes(x=block_size_id, y=regret, fill=age_group)) + 
	geom_boxplot(data = blocks, notch = FALSE) +
    xlab("Problem ID") +
    ylab("Regret") +
    facet_grid(. ~ block_size, drop = T) +
    scale_fill_hue(name="Age",          # Legend label, use darker colors
    breaks=c("old", "young"),
    labels=c("OA", "YA")) +
	theme_bw()
# dev.off()
```